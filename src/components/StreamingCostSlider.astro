---
// Define props for customization if needed
interface Props {
  minStreams?: number;
  maxStreams?: number;
  initialStreams?: number;
}

// Set default values
const {
  minStreams = 1,
  maxStreams = 8,
  initialStreams = 1
} = Astro.props;

// Calculate costs based on the pattern:
// 1x = 0,00€
// 2x = 0,02€
// 3x = 0,04€
// 4x = 0,08€
// 5x = 0,16€
// 6x = 0,32€
// 7x = 0,64€
// 8x = 1,28€
const calculateCost = (streams) => {
  if (streams === 1) return 0;
  if (streams === 2) return 0.02;
    if (streams === 3) return 0.04;
    if (streams === 4) return 0.08;
    if (streams === 5) return 0.16;
    if (streams === 6) return 0.32;
    if (streams === 7) return 0.64;
    if (streams === 8) return 1.28;
};
---

<div class="streaming-cost-calculator">
  <div class="flex flex-col">
    <div>
      <label for="stream-count" class="block text-sm font-medium mb-1">
        Number of streams: <span id="stream-display">{initialStreams}</span>
      </label>
      <input
        type="range"
        id="stream-count"
        min={minStreams}
        max={maxStreams}
        value={initialStreams}
        class="w-full bg-gray-200 rounded-lg appearance-none cursor-pointer"
      />
    </div>

    <div class="result-container p-4  rounded-md">
      <p class="text-sm mb-2">If you stream this song:</p>
      <div class="flex items-baseline">
        <span id="stream-result" class="text-3xl font-bold">{initialStreams}x</span>
        <span class="mx-2">=</span>
        <span id="cost-result" class="text-3xl font-bold">
          {calculateCost(initialStreams).toFixed(2).replace('.', ',')}€
        </span>
      </div>
    </div>
  </div>
</div>

<style>
  .streaming-cost-calculator {
    width: 100%;
    max-width: 500px;
    margin: 0 auto;

    border-radius: 0.5rem;


  }

  input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    height: 8px;
    border-radius: 4px;
    outline: none;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    background-color: #4B5563;
    border-radius: 50%;
    cursor: pointer;
  }

  input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background-color: #4B5563;
    border-radius: 50%;
    cursor: pointer;
  }
</style>

<script>
  // Get DOM elements
  const slider = document.getElementById('stream-count');
  const streamDisplay = document.getElementById('stream-display');
  const streamResult = document.getElementById('stream-result');
  const costResult = document.getElementById('cost-result');

  // Calculate cost function (must match the server-side one)
  const calculateCost = (streams) => {
      if (streams === 1) return 0;
      if (streams === 2) return 0.02;
      if (streams === 3) return 0.04;
      if (streams === 4) return 0.08;
      if (streams === 5) return 0.16;
      if (streams === 6) return 0.32;
      if (streams === 7) return 0.64;
      if (streams === 8) return 1.28;
  };

  // Update display when slider changes
  slider.addEventListener('input', () => {
    const streams = parseInt(slider.value);
    const cost = calculateCost(streams);

    // Update DOM elements
    streamDisplay.textContent = streams;
    streamResult.textContent = `${streams}x`;
    costResult.textContent = `${cost.toFixed(2).replace('.', ',')}€`;
  });
</script>
