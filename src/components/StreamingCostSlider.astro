---
// Define props for customization if needed
interface Props {
  minStreams?: number;
  maxStreams?: number;
  initialStreams?: number;
}

// Set default values
const {
  minStreams = 1,
  maxStreams = 9,
  initialStreams = 1
} = Astro.props;

const calculateCost = (streams: number): number | string => {
  if (streams > 8) return "Free Forever";
  if (streams === 1) return 0;
  if (streams === 2) return 0.02;
  if (streams === 3) return 0.04;
  if (streams === 4) return 0.08;
  if (streams === 5) return 0.16;
  if (streams === 6) return 0.32;
  if (streams === 7) return 0.64;
  if (streams === 8) return 1.28;
  return 0;
};

const formatCost = (cost: number | string): string => {
  if (typeof cost === "string") return cost;
  return `${cost.toFixed(2).replace('.', ',')}€`;
};
---

<div class="streaming-cost-calculator">
  <div class="flex flex-col">
    <div>
      <label for="stream-count" class="block text-sm font-medium mb-1">
        Number of streams per song: <span id="stream-display">{initialStreams}</span>
      </label>
      <input
        type="range"
        id="stream-count"
        min={minStreams}
        max={maxStreams}
        value={initialStreams}
        class="w-full background-surface rounded-lg appearance-none cursor-pointer"
        style="background: #4D2F2F"
      />
    </div>

    <div class="result-container rounded-md mt-2">
      <div class="flex items-baseline">
        <span id="stream-result" class="text-3xl font-bold">{initialStreams}x</span>
        <span class="mx-2">=</span>
        <span id="cost-result" class="text-3xl font-bold">
          {formatCost(calculateCost(initialStreams))}
        </span>
      </div>
    </div>
  </div>
</div>

<style>
  .streaming-cost-calculator {
    width: 100%;
    max-width: 500px;
    margin: 0 auto;

    border-radius: 0.5rem;


  }

  input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    height: 8px;
    border-radius: 4px;
    outline: none;
  }

  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    background-color: #ED4341;
    border-radius: 50%;
    cursor: pointer;
  }

  input[type="range"]::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background-color: #ED4341;
    border-radius: 50%;
    cursor: pointer;
  }
</style>

<script>
  // Get DOM elements
  const slider = document.getElementById('stream-count') as HTMLInputElement;
  const streamDisplay = document.getElementById('stream-display');
  const streamResult = document.getElementById('stream-result');
  const costResult = document.getElementById('cost-result');

  // Calculate cost function (must match the server-side one)
  const calculateCost = (streams: number): number | string => {
      if (streams > 8) return "Free Forever";
      if (streams === 1) return 0;
      if (streams === 2) return 0.02;
      if (streams === 3) return 0.04;
      if (streams === 4) return 0.08;
      if (streams === 5) return 0.16;
      if (streams === 6) return 0.32;
      if (streams === 7) return 0.64;
      if (streams === 8) return 1.28;
      return 0;
  };

  const formatCost = (cost: number | string): string => {
    if (typeof cost === "string") return cost;
    return `${cost.toFixed(2).replace('.', ',')}€`;
  };

  // Update display when slider changes
  if (slider) {
    slider.addEventListener('input', () => {
      const streams = parseInt(slider.value);
      const cost = calculateCost(streams);

      // Update DOM elements
      if (streamDisplay) streamDisplay.textContent = String(streams);
      if (streamResult) streamResult.textContent = `${streams}x`;
      if (costResult) costResult.textContent = formatCost(cost);
    });
  }
</script>
