let r=[];const n=document.getElementById("main-dropzone"),c=document.getElementById("main-file-input"),g=document.getElementById("selected-files-container"),h=document.getElementById("files-list"),o=document.getElementById("add-another-container"),u=document.getElementById("additional-file-input"),d=document.getElementById("contract-upload-form");function b(e){return["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(e.type)?e.size>10485760?(alert(`File too large: ${e.name}
Maximum size is 10MB.`),!1):!0:(alert(`Invalid file type: ${e.name}
Only PDF, DOC, and DOCX are allowed.`),!1)}function w(e,t){const a=document.createElement("div");return a.className="flex items-center justify-between p-3 bg-[var(--bg-primary)] rounded-lg border border-[var(--accent)]/20",a.innerHTML=`
			<div class="flex items-center gap-2">
				<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[var(--accent)]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
				</svg>
				<span class="text-[var(--text-primary)] text-sm truncate max-w-[180px]">${e.name}</span>
			</div>
			<button type="button" class="remove-file-btn text-[var(--text-secondary)] hover:text-[var(--accent)] transition-colors" data-index="${t}">
				<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
				</svg>
			</button>
		`,a}function m(){h.innerHTML="",r.forEach((e,t)=>{const a=w(e,t);h.appendChild(a)}),r.length>0?(n.classList.add("hidden"),g.classList.remove("hidden"),document.querySelectorAll(".remove-file-btn").forEach(e=>{e.addEventListener("click",function(){const t=parseInt(this.getAttribute("data-index"));E(t)})})):(n.classList.remove("hidden"),g.classList.add("hidden"))}function s(e){b(e)&&(r.push(e),m())}function E(e){r.splice(e,1),m()}c.addEventListener("change",e=>{const t=e.target.files[0];t&&(s(t),c.value="")});u.addEventListener("change",e=>{const t=e.target.files[0];t&&(s(t),u.value="")});n.addEventListener("click",()=>{c.click()});o.addEventListener("click",()=>{u.click()});n.addEventListener("dragover",e=>{e.preventDefault(),n.classList.add("border-[var(--accent)]")});n.addEventListener("dragleave",()=>{n.classList.remove("border-[var(--accent)]")});n.addEventListener("drop",e=>{if(e.preventDefault(),n.classList.remove("border-[var(--accent)]"),e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];s(t)}});o.addEventListener("dragover",e=>{e.preventDefault(),o.classList.add("border-[var(--accent)]")});o.addEventListener("dragleave",()=>{o.classList.remove("border-[var(--accent)]")});o.addEventListener("drop",e=>{if(e.preventDefault(),o.classList.remove("border-[var(--accent)]"),e.dataTransfer.files.length>0){const t=e.dataTransfer.files[0];s(t)}});d.addEventListener("submit",async e=>{if(e.preventDefault(),r.length===0){alert("Please select at least one file to upload");return}const t=d.querySelector('button[type="submit"]'),a=t.textContent;try{t.disabled=!0,t.textContent="Uploading...";const y=document.getElementById("context")?.value||"",f=document.getElementById("email")?.value;if(!f){alert("Please provide your email address");return}const i=new FormData;r.forEach(x=>{i.append("file",x)}),i.append("additionalContext",y),i.append("email",f);const v=await fetch("/api/upload-contract",{method:"POST",body:i}),l=await v.json();v.ok&&l.success?(alert(`Success! Your contract has been submitted for review.

Submission ID: ${l.submissionId}

You'll receive a detailed analysis at your provided email within 5-7 business days.`),d.reset(),r=[],m()):alert(`Error: ${l.error||"Failed to upload contract. Please try again."}`)}catch(p){console.error("Upload error:",p),alert("An error occurred while uploading your contract. Please try again.")}finally{t.disabled=!1,t.textContent=a||"Submit Contract for Review"}});
